<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Local JSON Parser</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 95%;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .container {
            display: flex;
            gap: 1rem;
            height: 60vh;
        }

        textarea {
            flex: 1;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-family: monospace;
            resize: none;
        }

        button {
            padding: 0.8rem 2rem;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
        }

        button:hover {
            background: #1d4ed8;
        }

        .success {
            color: green;
            display: none;
            margin-top: 0.5rem;
        }

        .error {
            color: red;
            display: none;
            margin-top: 0.5rem;
        }

        .trust-badge {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
    </style>
</head>

<body>

    <div class="trust-badge">
        <h3>üõ°Ô∏è 100% Privacy Guaranteed</h3>
        <p>This tool runs entirely in your browser using JavaScript.</p>
        <p>Your data <strong>never</strong> leaves your device. You can verify this by turning off your internet
            connection.</p>
    </div>

    <h1>Local JSON Formatter</h1>

    <div class="container">
        <textarea id="input" placeholder="Paste messy JSON here..."></textarea>
        <!-- Added Output Area for Go Struct -->
        <textarea id="output-go" placeholder="Go Struct will appear here..."
            style="background-color: #f8fafc; color: #334155; border-color: #cbd5e1;" readonly></textarea>
    </div>

    <div style="margin-top: 1rem;">
        <button onclick="formatJSON()">Format JSON ‚ú®</button>
        <button onclick="jsonToGo()" style="background:#0ea5e9">JSON to Go üêπ</button>
        <button onclick="minifyJSON()" style="background:#4b5563">Minify</button>
        <span id="msg-success" class="success">Formatted successfully locally!</span>
        <span id="msg-error" class="error">Invalid JSON</span>
    </div>

    <script>
        // Check this script! No 'fetch', no 'XMLHttpRequest'. 
        // Everything happens in local variable 'input' and 'output'.

        function formatJSON() {
            const input = document.getElementById('input');
            const successMsg = document.getElementById('msg-success');
            const errorMsg = document.getElementById('msg-error');

            try {
                // 1. Parsing: Browser memory -> JS Object
                const obj = JSON.parse(input.value);

                // 2. Formatting: JS Object -> String (with 4 spaces indentation)
                const formatted = JSON.stringify(obj, null, 4);

                // 3. Update UI
                input.value = formatted;

                successMsg.innerText = "Formatted successfully!";
                successMsg.style.display = 'inline-block';
                errorMsg.style.display = 'none';
                setTimeout(() => successMsg.style.display = 'none', 3000);
            } catch (e) {
                errorMsg.innerText = "Error: " + e.message;
                errorMsg.style.display = 'inline-block';
                successMsg.style.display = 'none';
            }
        }

        function minifyJSON() {
            const input = document.getElementById('input');
            try {
                const obj = JSON.parse(input.value);
                input.value = JSON.stringify(obj);
            } catch (e) {
                alert("Invalid JSON");
            }
        }

        // --- New Feature: JSON to Go Struct ---
        function jsonToGo() {
            const input = document.getElementById('input');
            const outputGo = document.getElementById('output-go');
            const errorMsg = document.getElementById('msg-error');
            const successMsg = document.getElementById('msg-success');

            try {
                const obj = JSON.parse(input.value);

                // Root struct name
                const goCode = "type AutoGenerated struct {\n" + generateGoStruct(obj, 1) + "}";

                outputGo.value = goCode;
                successMsg.innerText = "Converted to Go Struct!";
                successMsg.style.display = 'inline-block';
                errorMsg.style.display = 'none';
            } catch (e) {
                errorMsg.innerText = "Error: " + e.message;
                errorMsg.style.display = 'inline-block';
                outputGo.value = "";
            }
        }

        // Recursive function to generate struct fields
        function generateGoStruct(obj, indentLevel) {
            let result = "";
            const indent = "\t".repeat(indentLevel);

            for (const key in obj) {
                const value = obj[key];
                const fieldName = toPascalCase(key);
                const jsonTag = ` \`json:"${key}"\``;
                let type = "interface{}";

                if (value === null) {
                    type = "interface{}"; // or *string, difficult to guess
                } else if (typeof value === "string") {
                    type = "string";
                } else if (typeof value === "number") {
                    type = Number.isInteger(value) ? "int" : "float64";
                } else if (typeof value === "boolean") {
                    type = "bool";
                } else if (Array.isArray(value)) {
                    // Simple check for array type (checking first element)
                    if (value.length > 0) {
                        const first = value[0];
                        if (typeof first === "string") type = "[]string";
                        else if (typeof first === "number") type = Number.isInteger(first) ? "[]int" : "[]float64";
                        else if (typeof first === "boolean") type = "[]bool";
                        else if (typeof first === "object") {
                            // Inline struct for array of objects
                            type = "[]struct {\n" + generateGoStruct(first, indentLevel + 1) + indent + "}";
                        }
                    } else {
                        type = "[]interface{}";
                    }
                } else if (typeof value === "object") {
                    // Nested struct
                    type = "struct {\n" + generateGoStruct(value, indentLevel + 1) + indent + "}";
                }

                result += `${indent}${fieldName} ${type}${jsonTag}\n`;
            }
            return result;
        }

        // Helper: convert "user_id" -> "UserId"
        function toPascalCase(str) {
            return str
                .replace(/[^a-zA-Z0-9]+(.)/g, (m, chr) => chr.toUpperCase())
                .replace(/^[a-z]/, c => c.toUpperCase());
        }
    </script>
</body>

</html>